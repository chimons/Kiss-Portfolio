<?php$id=(isset($_GET['id']) ? $_GET['id'] : "");$action=NULL;$categories=get_categories();$titre_categorie_parente="";$id_categorie_parente = $id;$titre = "";$texte = "";$vignette = "";$active = NULL;$messages=array();if (isset($_POST['poste'])){	switch ($_POST['action']){		case "ajouter":		if (isset($_FILES['miniature']) AND isset($_POST["categorie_parente"]) AND isset ($_POST["titre"]) AND isset($_POST["texte"]) AND !empty($_FILES['miniature']) AND !empty($_POST["categorie_parente"]) AND !empty($_POST["titre"]) AND !empty($_POST["texte"])){																		if ($id_rubrique=ajouter_rubrique($_POST["categorie_parente"], $_POST["titre"], $_POST["texte"], "defaut.png", $active=(isset($_POST['active'])? 1 : 0))){					$action="consulter";					$messages[]="La rubrique a été correctement ajoutée.";					$id=$id_rubrique;										if($_FILES['miniature']['error'] != UPLOAD_ERR_NO_FILE){						if($fichier=traitement_fichier_upload($_FILES['miniature'], 'image')){							$dossier="images/thumbs/";							$fichier=$id."-".$fichier;							if(move_uploaded_file($_FILES['miniature']['tmp_name'], $dossier.$fichier)) {								resize_img($dossier.$fichier, $dossier.$fichier);								modifier_image_rubrique($id, $fichier);							}							else{								$messages[]="Erreur à l'ajout de l'image (Véfifier les droits d'écriture)";							}						}						else{							$action="ajouter";							$messages[]="L'insertion a échoué (Verifier l'image).";						}					}				}				else{					$action="ajouter";					$messages[]="L'écriture dans la base de données a échoué.";				}					}		else{			$action="ajouter";			$messages[]="Tous les champs n'ont pas été renseignés.";			$titre = $_POST["titre"];			$texte = $_POST["texte"];		}		break;					case "modifier":			if (isset($_POST["categorie_parente"]) AND isset ($_POST["titre"]) AND isset($_POST["texte"]) AND !empty($_POST["categorie_parente"]) AND !empty($_POST["titre"]) AND !empty($_POST["texte"])){				if (modifier_rubrique($_POST["id"],  $_POST["categorie_parente"], $_POST["titre"], $_POST["texte"], $active=(isset($_POST['active'])? 1 : 0))){					if (isset($_FILES['miniature']) AND $_FILES['miniature']['error'] != UPLOAD_ERR_NO_FILE){						if($fichier=traitement_fichier_upload($_FILES['miniature'], "image")){							$id=$_POST['id'];							$dossier="images/thumbs/";							$fichier=$id."-".$fichier;							if(move_uploaded_file($_FILES['miniature']['tmp_name'], $dossier.$fichier)) {								resize_img($dossier.$fichier, $dossier.$fichier);								$ancienne_image=get_nom_image_rubrique($id);								if(modifier_image_rubrique($id, $fichier)){									@unlink($dossier.$ancienne_image);								}							}							else{								$messages[]="Erreur à l'ajout de l'image";							}						}						else{							$action="ajouter";							$messages[]="L'insertion a échoué (Verifier l'image).";						}					}					$action="consulter";					$id=$_POST["id"];					$messages[]="La rubrique a été correctement éditée.";				}				else{					$action="modifier";					$messages[]="La mise à jour a échoué";				}			}			else{				$action="modifier";				$messages[]="Tous les champs n'ont pas été renseignés.";			}						break;					default : 				$messages[]="Une erreur est survenue";			break;		}}if(isset($_GET['supprimer'])){	if($rubrique=get_une_rubrique($id)){		$image=$rubrique['rub_image'];		if (supprimer_une_rubrique($id)){			$messages[]="La rubrique a été correctement supprimée.";			if($image!="defaut.png"){				if(!@unlink("images/thumbs/".$image)){					$messages[]="L'image n'a pu être effacée ou n'existe plus.";				}			}		}		else{			$action="consulter";			$messages[]="La suppression a échoué.";		}	}	else{		$messages[]="Cette rubrique n'existe pas.";	}		}if(isset($_GET['ajouter']) AND $action!="consulter"){	if (empty($categories)){		$action="invite_ajouter_categorie";	}	else{		$action="ajouter";	}}if((isset($_GET['consulter']) && isset($id)) OR $action=="consulter"){	if(get_titre_rubrique($id)){		$action="consulter";		$la_rubrique=get_une_rubrique($id);		$rub_articles=get_articles($la_rubrique['id_rubrique']);		$titre_categorie_parente = get_titre_categorie($la_rubrique['id_cat']);	}	else{		$messages[]="Cette rubrique n'existe pas.";	}}if((isset($_GET['modifier']) AND isset($_GET['id']) AND $action!="consulter") OR ($action=="modifier")){	$action="modifier";	$la_rubrique=get_une_rubrique($id);	$titre_categorie_parente = get_titre_categorie($la_rubrique['id_cat']);	$id_categorie_parente = $la_rubrique['id_cat'];	$titre = $la_rubrique['rub_titre'];	$texte = $la_rubrique['rub_texte'];	$vignette = $la_rubrique['rub_image'];	$active = $la_rubrique['active'];}$categories=get_categories();$rubriques=get_toutes_les_rubriques();$articles=get_tous_les_articles();include ("v/v_rubriques.php");