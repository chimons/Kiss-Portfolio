<?php$id=(isset($_GET['id']) ? $_GET['id'] : "");$action=NULL;$categories=get_categories();$titre_rubrique_parente="";$id_rubrique_parente = "";$id_type_lien = "";$titre = "";$url = "";$type_lien = "";$texte = "";$active = NULL;$messages=array();if (isset($_POST['poste'])){	switch ($_POST['action']){		case "ajouter":			if(isset($_POST["rubrique_parente"]) AND isset($_POST["titre"]) AND isset($_POST["type_lien"]) AND isset($_POST["texte"]) AND (isset($_POST["url"]) OR ($_FILES['document']['error'] != UPLOAD_ERR_NO_FILE))){								if($id_article=ajouter_article($_POST["rubrique_parente"], $_POST["titre"], $_POST["type_lien"], $_POST["texte"], $active=(isset($_POST['active'])? 1 : 0))){								$action="consulter";					$messages[]="L'article a été correctement ajouté.";					$id=$id_article;										if($_FILES['document']['error'] != UPLOAD_ERR_NO_FILE){						if($fichier=traitement_fichier_upload($_FILES['document'], 'document')){							$dossier="documents/";							$fichier=$id."-".$fichier;							if(move_uploaded_file($_FILES['document']['tmp_name'], $dossier.$fichier)) {								modifier_lien_article($id, "documents/".$fichier);							}							else{								$messages[]="Erreur à l'ajout du document. (Véfifier les droits d'écriture)";							}						}						else{							$action="ajouter";							$messages[]="L'insertion a échoué (Vérifier le document).";						}					}					elseif (isset($_POST['url']) AND !empty($_POST['url'])){						$lien=valider_lien_article( $_POST['url']);						modifier_lien_article($id, $lien);					}				}				else{					$action="ajouter";					$messages[]="L'écriture dans la base de données a échoué.";				}			}			else{				$action="ajouter";				$messages[]="Tous les champs n'ont pas été renseignés.";				$titre = $_POST["titre"];				$texte = $_POST["texte"];			}													break;					case "modifier":			if(isset($_POST["rubrique_parente"]) AND isset($_POST["titre"]) AND isset($_POST["type_lien"]) AND isset($_POST["texte"]) AND (isset($_POST["url"]) OR ($_FILES['document']['error'] != UPLOAD_ERR_NO_FILE))){				if(modifier_article($_POST['id'], $_POST["rubrique_parente"], $_POST["titre"], $_POST["type_lien"], $_POST["texte"], $active=(isset($_POST['active'])? 1 : 0))){					if($_FILES['document']['error'] != UPLOAD_ERR_NO_FILE){						if($fichier=traitement_fichier_upload($_FILES['document'], 'document')){							$id=$_POST['id'];							$dossier="documents/";							$fichier=$id."-".$fichier;							if(move_uploaded_file($_FILES['document']['tmp_name'], $dossier.$fichier)) {								$ancien_document=get_url_document_article($id);								if(modifier_lien_article($id, "documents/".$fichier)){									@unlink($ancien_document);								}							}							else{								$messages[]="Erreur à l'ajout du document. (Véfifier les droits d'écriture)";							}						}						else{							$action="modifier";							$messages[]="Le lien n'a pas été modifié";						}					}					elseif (isset($_POST['url'])){						$lien=valider_lien_article( $_POST['url']);						modifier_lien_article($id, $lien);					}										$action="consulter";					$id=$_POST["id"];					$messages[]="L'article a été correctement édité.";				}				else{					$action="modifier";					$messages[]="La mise à jour a échoué";				}			}			else{				$action="modifier";				$messages[]="Tous les champs n'ont pas été renseignés.";			}												break;					default : 				$messages[]="Une erreur est survenue";			break;		}}if(isset($_GET['supprimer'])){	if($article=get_un_article($id)){		$document=$article['art_url'];				if(supprimer_un_article($id)){				$messages[]="L'article a été correctement supprimé.";			if(preg_match("#^documents/#", $document)){				if(!@unlink($document)){					$messages[]="Le fichier n'a pu être effacée ou n'existe plus.";				}			}		}		else{			$action="consulter";			$messages[]="La suppression a échoué.";		}	}	else{		$messages[]="Cet article n'existe pas.";	}}if(isset($_GET['ajouter']) AND $action!="consulter"){		if (empty($rubriques)){		$action="invite_ajouter_rubrique";	}	else{		$action="ajouter";	}}if((isset($_GET['consulter']) && isset($_GET['id'])) OR $action=="consulter"){	$action="consulter";	$le_article=get_un_article($id);	$rubrique_parente = get_une_rubrique($le_article['id_rubrique']);	$titre_rubrique_parente = $rubrique_parente['rub_titre'];	$titre_categorie_parente = get_titre_categorie($rubrique_parente['id_cat']);	$id_type_lien = $le_article['art_type_lien'];	$libelle_type_lien = get_libelle_type_lien($id_type_lien);}if((isset($_GET['modifier']) AND isset($_GET['id']) AND $action!="consulter") OR ($action=="modifier")){	$action="modifier";	$le_article=get_un_article($id);	$rubrique_parente = get_une_rubrique($le_article['id_rubrique']);	$titre_rubrique_parente = $rubrique_parente['rub_titre'];		$id_rubrique_parente = $rubrique_parente['id_rubrique'];	$titre = $le_article['art_titre'];	$url = $le_article['art_url'];	$id_type_lien = $le_article['art_type_lien'];	$libelle_type_lien = get_libelle_type_lien($id_type_lien);	$texte = $le_article['art_texte'];	$active = $le_article['active'];	}$types_liens=get_types_liens();$categories=get_categories();$rubriques=get_toutes_les_rubriques();$articles=get_tous_les_articles();include ("v/v_articles.php");